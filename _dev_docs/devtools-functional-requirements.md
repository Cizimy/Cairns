# タスク 1.2.5 最終成果物: Cairns 開発・運用ツール 機能要件リスト (v1.1)

**バージョン:** 1.1 (2025-04-29 監査/改善担当フィードバック反映版)

**目的:**
このリストは、`Document map` v1.0 および `JSON Schema` v2.0.1 に基づき定義された Cairns (Project Philosophy Library) の開発・運用プロセスを支援するために必要なツール群の機能要件を定義します。後続のツール選定タスク (1.2.6 以降) のための基礎情報となります。

**分類:**

* **必須 (Mandatory):** Cairns の基本的な開発・品質維持プロセス、およびその持続的な運用に不可欠な要件。(`Document map` で CI による検証が必須とされている項目、および開発者体験 (DX) のコア要素を含む)
* **推奨/将来必要 (Recommended/Future):** より高度な運用効率化、AI連携、ガバナンス強化のために推奨される、または将来的に必要となる可能性が高い要件。

---

## A. 必須 (Mandatory) 要件

### A1. YAML Linter (YAML構文・スタイル検証ツール)
* `A-1.1`: YAML Front Matter の構文的正当性を検証できること。
* `A-1.2`: 設定ファイルに基づき、インデントや記法などの基本的なスタイル規約を適用・検証できること。

### A2. Markdown Linter (Markdown構文・スタイル検証ツール)
* `A-2.1`: Markdown 本文の構文的正当性を検証できること。
* `A-2.2`: 設定ファイルに基づき、見出しレベルの順序やリスト形式などのスタイル規約を適用・検証できること。

### A3. JSON Schema Validator (Front Matter スキーマ検証ツール)
* `A-3.1`: YAML Front Matter を `cairns-front-matter.schema.json` (v2.0.1 および将来の後継バージョン) に基づき、厳密に検証できること。
* `A-3.2`: JSON Schema **Draft 2020-12** 仕様に完全準拠していること。
* `A-3.3`: スキーマファイル間の外部参照 (`$ref`) を正しく解決できること。
* `A-3.4`: スキーマファイル間の動的参照 (`$dynamicRef`) を正しく解決できること。
* `A-3.5`: スキーマ内の条件付き必須項目 (`if`/`then`, `dependentRequired` 等) を正しく評価できること。

### A4. Git クライアント / プラットフォーム
* `A-4.1`: ソースコード（ドキュメントファイル）のバージョン管理を行える基本的な機能（コミット、ブランチ、マージ、プッシュ、プル等）を提供すること。
* `A-4.2`: 変更履歴の追跡、差分表示機能を提供すること。

### A5. CI/CD プラットフォーム (例: GitHub Actions)
* `A-5.1`: Git リポジトリへの Push や Pull Request 作成などのイベントをトリガーとして、定義されたワークフローを自動実行できること。
* `A-5.2`: 上記の Linter (A1, A2)、Validator (A3)、および後述のカスタム検証スクリプト/ツール群 (A6) をワークフローのステップとして実行し、連携できること。
* `A-5.3`: ワークフローの実行結果（成功/失敗/警告）を Pull Request 等にフィードバックし、必須要件を満たさない場合にマージをブロックできること。
* `A-5.4`: 各ステップの実行ログを確認できること。
* `A-5.5`: (将来的に) デプロイメントパイプラインの構築・実行機能。
* `A-5.6`: (将来的に) Secrets管理機能。

### A6. カスタム検証スクリプト / ツール群 (CI/CD連携)
    * *注記: これらの検証は `Document map` において CI による自動検証が必須とされています。`Action Plan` に基づき段階的に CI へ実装されますが、機能要件としては必須と位置づけられます。*
* `A-6.1`: **参照整合性検証:** `Document map` の「CI/CDによる自動検証」項目で定義された各種参照フィールド（例: `detail_ref`, `snippet_refs`, `media.path`, `relationships.from/to`, `references.doc_id`, `deprecation_info.replaced_by_*` 等）について、参照先のファイル、アンカー、ドキュメントID、Principle IDがリポジトリ内に実在することを検証できること。
* `A-6.2`: **ID整合性・一意性検証:** ドキュメント `id` がリポジトリ全体で一意であること、ファイル名（拡張子除く）と一致すること、および命名規則 (`patterns.schema.json#pattern-docId`) に準拠していることを検証できること。`core_principles` 内の `principle_id` がドキュメント内で一意であること。
* `A-6.3`: **時間整合性検証:** `created_at`, `last_updated`, `expires_at` の前後関係 (`created_at <= last_updated <= expires_at`) を検証できること。`review_cycle_days` が設定されている場合に、`expires_at` または現在日時と比較し、レビュー期限超過や期限間近を警告できること。
* `A-6.4`: **言語整合性検証:** `language`, `preferred_langs`, `localized_overrides` のキーとして使用される BCP-47 言語コードの形式的正当性、および相互の整合性（例: `language` が `preferred_langs` に含まれるか等）を検証できること。

### A7. 開発者体験 (DX) 支援
    * *注記: これらの要件は、Cairns システムの持続的な利用、貢献、および品質維持のために必須と位置づけられます。*
* `A-7.1`: 主要な検証ツール（Linter: A1, A2、Validator: A3）が、開発者のローカル環境で容易に実行可能であること。
* `A-7.2`: 主要な検証ツールが、一般的な開発エディタ（特に VSCode）と連携し、リアルタイムに近いフィードバックを提供できること（例: 拡張機能）。
* `A-7.3`: 検証ツール (A1, A2, A3, A6) が出力するエラーメッセージが、問題箇所と原因を特定するのに十分な具体性と明確性を持つこと。

---

## B. 推奨 / 将来必要 (Recommended / Future) 要件

### B1. 静的サイトジェネレーター (SSG)
* `B-1.1`: Markdown ファイルと YAML Front Matter を入力として、閲覧可能な HTML ウェブサイトを生成できること。
* `B-1.2`: Front Matter 内の `relationships` データを解釈し、ドキュメント間の関連性をグラフ等で視覚的に表示する機能（標準機能またはプラグインで実現可能）を持つこと。
* `B-1.3`: Front Matter 内の `localized_overrides` データを解釈し、ユーザーが言語を切り替えてコンテンツを表示できる機能を持つこと。
* `B-1.4`: サイト内のコンテンツに対する効果的な全文検索機能を提供すること。
* `B-1.5`: デザインテーマ、レイアウト、ナビゲーション等のカスタマイズが可能であること。
* `B-1.6`: CI/CD パイプラインから容易にビルドおよびデプロイ（例: GitHub Pages へ）が可能であること。

### B2. RAG Index 生成ツール / スクリプト (CI/CD連携)
* `B-2.1`: リポジトリ内の全 Cairns ドキュメント（YAML Front Matter および必要に応じて Markdown 本文）を解析できること。
* `B-2.2`: `l0-cairns-overview.md` で定義される RAG Index の仕様に基づき、必要な情報を抽出・整形し、指定されたフォーマット（例: `index.ndjson`）で Index ファイルを生成・出力できること。

### B3. Checksum 生成・検証ツール / スクリプト (CI/CD連携)
* `B-3.1`: ドキュメントのコンテンツ（Markdown本文またはファイル全体）に対する Checksum (SHA256 または SHA512) を計算・生成できること。
* `B-3.2`: Front Matter 内の `checksum` フィールドに記録された値と、算出した Checksum 値を比較・検証できること（`APPROVED`/`FIXED` ステータスのドキュメント等、特定の条件下で実行）。

### B4. 署名検証ツール / スクリプト (CI/CD連携)
* `B-4.1`: Front Matter 内の `signed_by` フィールドに記録された署名情報（アルゴリズム、鍵識別子、署名値）に基づき、電子署名（例: PGP, X.509）の有効性を検証できること（公開鍵/証明書の管理・参照方法が必要）。

### B5. LLM 連携ツール / ライブラリ (CI/CD連携・実験的)
* `B-5.1`: ドキュメント間の意味的な類似度を計算し、設定された閾値に基づいて潜在的な重複や関連性の強いドキュメントを検出・報告できること。
* `B-5.2`: (オプション) ドキュメントの要約生成、キーワード抽出など、レビューや理解を支援する機能を提供できること。